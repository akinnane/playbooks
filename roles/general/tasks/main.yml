- name: Spotify apt key1
  apt_key:
    keyserver: keyserver.ubuntu.com
    id: 0DF731E45CE24F27EEEB1450EFDC8610341D9410

- name: Spotify apt key2
  apt_key:
    keyserver: keyserver.ubuntu.com
    id: 931FF8E79F0876134EDDBDCCA87FF9DF48BF1C90

- name: Spotify Repo
  apt_repository:
    repo: deb http://repository.spotify.com stable non-free
    state: present

- name: Google apt key
  apt_key:
    url: https://dl-ssl.google.com/linux/linux_signing_key.pub

- name: Google Repo
  apt_repository:
    repo: deb [arch=amd64] https://dl.google.com/linux/chrome/deb/ stable main

- Name: Update everything
  apt:
    upgrade: dist
    update_cache: yes

- name: Install base packages
  apt:
    state: present
    pkg: "{{item}}"
  with_items:
    - audacity
    - awesome
    - awesome-extra
    - curl
    - emacs
    - google-chrome-stable
    - gparted
    - iptables-persistent
    - nmap
    - net-tools
    - network-manager-openconnect
    - network-manager-openconnect-gnome
    - ngrep
    - openconnect
    - openssh-server
    - openconnect
    - network-manager-openconnect
    - network-manager-openconnect-gnome
    - python3-pip
    - qemu
    - rar
    - ruby
    - smbclient
    - spotify-client
    - tor
    - unattended-upgrades
    - virt-manager
    - virtualenv
    - virt-viewer
    - vlc
    - wireshark
    - xscreensaver
    - zsh

- name: Install Dev tools
  apt:
    state: present
    pkg: "{{item}}"
  with_items:
    - ansible
    - checkinstall
    - chromium-chromedriver
    - docker
    - docker.io
    - python3-pip
    - ruby
    - virtualbox

- name: Install Sec tools
  apt:
    state: present
    pkg: "{{item}}"
  with_items:
    - nmap
    - ngrep
    - tor
    - wireshark

- name: Mange etc
  synchronize:
    src: etc
    dest: /
    checksum: yes
    archive: no
    recursive: yes
  notify:
    - dconf-db
    - netfilter-persistent

- name: Add user
  user:
    name: a
    shell: /bin/zsh
    uid: 11111
    groups: adm,sudo,plugdev,lpadmin,sambashare,libvirt,libvirt-qemu,docker

- name: Manage home .files
  synchronize:
    src: home/a
    dest: /home/
    archive: no
    checksum: yes
    recursive: yes

- name: Oh my zsh
  git:
    repo: https://GitHub.com/robbyrussell/oh-my-zsh.git
    dest: /home/a/.oh-my-zsh

- name: emacs prelude
  git:
    repo: https://github.com/akinnane/prelude.git
    dest: /home/a/.emacs.d

- name: ssh-server
  systemd:
    name: ssh
    enabled: yes
    state: started

- name: netfilter-persistent
  systemd:
    name: netfilter-persistent
    enabled: yes
    state: started

- name: cups
  systemd:
    name: cups
    enabled: no
    state: stopped

- name: tor
  systemd:
    name: tor
    enabled: no
    state: stopped

- name: cups
  systemd:
    name: avahi-daemon
    enabled: no
    state: stopped

- name: Schedule automatic ansible updates
  cron:
    name: ansible
    minute: 0
    user: root
    cron_file: ansible-update
    job: /usr/bin/ansible-pull -U https://github.com/akinnane/playbooks.git -i localhost,

- name: Set homedir permissions
  file:
    dest: /home/a
    owner: a
    group: a
    mode: u=rwX,g=rX,o=rX
    recurse: yes
